using System.Diagnostics;
using GeoAPI.Geometries;
using NetTopologySuite.Geometries;
using NetTopologySuite.Geometries.Utilities;
using NetTopologySuite.IO;
using NetTopologySuite.Operation.Valid;
using NetTopologySuite.SnapRound;
using NUnit.Framework;

namespace NetTopologySuite.Tests.NUnit.Operation.Overlay
{
    public class SnapRoundOverlayTest
    {
        const string Geom1a =
            @"POLYGON ((600550.22898384 6187811.3120985, 600567.02901744 6187760.9119977, 600644.02917144 6187685.3118465, 600639.82916304 6187688.1118521, 600550.22898384 6187811.3120985))";

        const string Geom1b =
            @"POLYGON ((600324.317996225 6187730.71530786, 600337.84118087 6187710.59940239, 600399.660275558 6187625.4967248, 600403.511084844 6187622.99723356, 600409.514059492 6187626.8064582, 600419.821364862 6187636.62445978, 600429.551461131 6187649.94174908, 600441.062659768 6187662.29923375, 600450.553626553 6187674.65671842, 600453.423180368 6187678.39595731, 600460.902161145 6187684.4447261, 600493.102183121 6187699.11174067, 600517.237769375 6187710.88934337, 600529.021080874 6187713.46881833, 600557.502227073 6187712.31905236, 600578.471409118 6187711.45922738, 600623.040197538 6187710.01952042, 600644.611326216 6187709.73957741, 600726.649231118 6187708.48983179, 600747.577183941 6187781.75491889, 600747.519463031 6187781.83490261, 600624.730595619 6187947.66114916, 600624.507957823 6187947.96108811, 600611.06723162 6187938.05310485, 600586.05758587 6187918.69704472, 600589.702249049 6187906.86945219, 600597.428605154 6187886.40361795, 600596.068040845 6187868.64723221, 600589.240481768 6187864.09815816, 600573.771277869 6187869.1071386, 600555.119178071 6187872.74639784, 600539.212944424 6187873.73619637, 600524.461128979 6187874.04613328, 600489.210144613 6187848.00143461, 600476.107498027 6187838.31340657, 600475.456076327 6187837.7935124, 600475.282913597 6187837.63354496, 600475.216946842 6187837.58355513, 600474.837638005 6187837.28361618, 600471.902117435 6187835.21403744, 600470.492078061 6187834.21424095, 600462.130791945 6187828.2954457, 600453.010888153 6187821.85675628, 600434.490721864 6187808.7894161, 600409.514059492 6187790.50313822, 600391.818477632 6187778.67554569, 600377.421233491 6187768.49761738, 600377.140874785 6187768.86754208, 600374.460975389 6187767.07790635, 600324.317996225 6187730.71530786))";

        const string Geom2a =
            @"POLYGON ((600447.93677926 6187850.1001761, 600422.73672886 6187836.8001495, 600469.63682266 6187765.4000067, 600469.63682266 6187764.7000053, 600447.93677926 6187850.1001761))";

        const string Geom2b =
            @"POLYGON ((600340.493491189 6187819.45791622, 600374.26845628 6187772.85745585, 600453.62932648 6187826.94572043, 600475.67871412 6187843.14242364, 600535.98057346 6187885.44381332, 600570.62961119 6187912.43831866, 600619.23061747 6187945.74153989, 600639.99365341 6187959.43875186, 600627.36926579 6187968.26695491, 600587.540057264 6187993.1840066, 600587.283262335 6187993.00342535, 600587.540057264 6187992.83122901, 600548.29729155 6187965.58802593, 600340.493491189 6187819.45791622))";

        const string Geom3a =
            @"POLYGON ((600447.93677926 6187850.1001761, 600422.73672886 6187836.8001495, 600469.63682266 6187765.4000067, 600469.63682266 6187764.7000053, 600447.93677926 6187850.1001761))";

        const string Geom3b =
            @"POLYGON ((600324.317996225 6187730.71530786, 600337.84118087 6187710.59940239, 600399.660275558 6187625.4967248, 600403.511084844 6187622.99723356, 600409.514059492 6187626.8064582, 600419.821364862 6187636.62445978, 600429.551461131 6187649.94174908, 600441.062659768 6187662.29923375, 600450.553626553 6187674.65671842, 600453.423180368 6187678.39595731, 600460.902161145 6187684.4447261, 600493.102183121 6187699.11174067, 600517.237769375 6187710.88934337, 600529.021080874 6187713.46881833, 600557.502227073 6187712.31905236, 600578.471409118 6187711.45922738, 600623.040197538 6187710.01952042, 600644.611326216 6187709.73957741, 600726.649231118 6187708.48983179, 600747.577183941 6187781.75491889, 600747.519463031 6187781.83490261, 600624.730595619 6187947.66114916, 600624.507957823 6187947.96108811, 600611.06723162 6187938.05310485, 600586.05758587 6187918.69704472, 600589.702249049 6187906.86945219, 600597.428605154 6187886.40361795, 600596.068040845 6187868.64723221, 600589.240481768 6187864.09815816, 600573.771277869 6187869.1071386, 600555.119178071 6187872.74639784, 600539.212944424 6187873.73619637, 600524.461128979 6187874.04613328, 600489.210144613 6187848.00143461, 600476.107498027 6187838.31340657, 600475.456076327 6187837.7935124, 600475.282913597 6187837.63354496, 600475.216946842 6187837.58355513, 600474.837638005 6187837.28361618, 600471.902117435 6187835.21403744, 600470.492078061 6187834.21424095, 600462.130791945 6187828.2954457, 600453.010888153 6187821.85675628, 600434.490721864 6187808.7894161, 600409.514059492 6187790.50313822, 600391.818477632 6187778.67554569, 600377.421233491 6187768.49761738, 600377.140874785 6187768.86754208, 600374.460975389 6187767.07790635, 600324.317996225 6187730.71530786))";
          //@"POLYGON ((600447.93677926 6187850.1001761, 600422.73672886 6187836.8001495, 600469.63682266 6187765.4000067, 600469.63682266 6187764.7000053, 600447.93677926 6187850.1001761))";

        const string Geom4a =
            @"POLYGON ((600447.93677926 6187850.1001761, 600422.73672886 6187836.8001495, 600469.63682266 6187765.4000067, 600469.63682266 6187764.7000053, 600447.93677926 6187850.1001761))";

        const string Geom4b =
            @"POLYGON ((600324.317996225 6187730.71530786, 600337.84118087 6187710.59940239, 600399.660275558 6187625.4967248, 600403.511084844 6187622.99723356, 600409.514059492 6187626.8064582, 600419.821364862 6187636.62445978, 600429.551461131 6187649.94174908, 600441.062659768 6187662.29923375, 600450.553626553 6187674.65671842, 600453.423180368 6187678.39595731, 600460.902161145 6187684.4447261, 600493.102183121 6187699.11174067, 600517.237769375 6187710.88934337, 600529.021080874 6187713.46881833, 600557.502227073 6187712.31905236, 600578.471409118 6187711.45922738, 600623.040197538 6187710.01952042, 600644.611326216 6187709.73957741, 600726.649231118 6187708.48983179, 600747.577183941 6187781.75491889, 600747.519463031 6187781.83490261, 600624.730595619 6187947.66114916, 600624.507957823 6187947.96108811, 600611.06723162 6187938.05310485, 600586.05758587 6187918.69704472, 600589.702249049 6187906.86945219, 600597.428605154 6187886.40361795, 600596.068040845 6187868.64723221, 600589.240481768 6187864.09815816, 600573.771277869 6187869.1071386, 600555.119178071 6187872.74639784, 600539.212944424 6187873.73619637, 600524.461128979 6187874.04613328, 600489.210144613 6187848.00143461, 600476.107498027 6187838.31340657, 600475.456076327 6187837.7935124, 600475.282913597 6187837.63354496, 600475.216946842 6187837.58355513, 600474.837638005 6187837.28361618, 600471.902117435 6187835.21403744, 600470.492078061 6187834.21424095, 600462.130791945 6187828.2954457, 600453.010888153 6187821.85675628, 600434.490721864 6187808.7894161, 600409.514059492 6187790.50313822, 600391.818477632 6187778.67554569, 600377.421233491 6187768.49761738, 600377.140874785 6187768.86754208, 600374.460975389 6187767.07790635, 600324.317996225 6187730.71530786))";

        const string Geom5a =
            @"POLYGON ((600447.93677926 6187850.1001761, 600422.73672886 6187836.8001495, 600469.63682266 6187765.4000067, 600469.63682266 6187764.7000053, 600447.93677926 6187850.1001761))";

        const string Geom5b =
            @"MULTIPOLYGON (((600548.29729155 6187965.58802593, 600501.044258405 6187932.78391656, 600340.288777426 6187819.64357722, 600308.306051507 6187866.45577176, 600406.246214967 6187935.82651594, 600418.238885504 6187938.85471894, 600424.65933969 6187950.64394421, 600431.78534905 6187970.19427639, 600435.583108981 6188027.75696937, 600465.455641203 6188049.81024852, 600487.567066505 6188059.86908971, 600587.283262335 6187993.00342535, 600587.540057264 6187993.1840066, 600627.36926579 6187968.26695491, 600639.99365341 6187959.43875186, 600619.23061747 6187945.74153989, 600570.62961119 6187912.43831866, 600535.98057346 6187885.44381332, 600475.67871412 6187843.14242364, 600453.62932648 6187826.94572043, 600374.26845628 6187772.85745585, 600340.493491189 6187819.45791622, 600548.29729155 6187965.58802593)), ((600324.317996225 6187730.71530786, 600374.460975389 6187767.07790635, 600377.140874785 6187768.86754208, 600377.421233491 6187768.49761738, 600391.818477632 6187778.67554569, 600409.514059492 6187790.50313822, 600434.490721864 6187808.7894161, 600453.010888153 6187821.85675628, 600462.130791945 6187828.2954457, 600470.492078061 6187834.21424095, 600471.902117435 6187835.21403744, 600474.837638005 6187837.28361618, 600475.216946842 6187837.58355513, 600475.282913597 6187837.63354496, 600475.456076327 6187837.7935124, 600476.107498027 6187838.31340657, 600489.210144613 6187848.00143461, 600524.461128979 6187874.04613328, 600539.212944424 6187873.73619637, 600555.119178071 6187872.74639784, 600573.771277869 6187869.1071386, 600589.240481768 6187864.09815816, 600596.068040845 6187868.64723221, 600597.428605154 6187886.40361795, 600589.702249049 6187906.86945219, 600586.05758587 6187918.69704472, 600611.06723162 6187938.05310485, 600624.507957823 6187947.96108811, 600624.730595619 6187947.66114916, 600747.519463031 6187781.83490261, 600747.577183941 6187781.75491889, 600726.649231118 6187708.48983179, 600644.611326216 6187709.73957741, 600623.040197538 6187710.01952042, 600578.471409118 6187711.45922738, 600557.502227073 6187712.31905236, 600529.021080874 6187713.46881833, 600517.237769375 6187710.88934337, 600493.102183121 6187699.11174067, 600460.902161145 6187684.4447261, 600453.423180368 6187678.39595731, 600450.553626553 6187674.65671842, 600441.062659768 6187662.29923375, 600429.551461131 6187649.94174908, 600419.821364862 6187636.62445978, 600409.514059492 6187626.8064582, 600403.511084844 6187622.99723356, 600399.660275558 6187625.4967248, 600337.84118087 6187710.59940239, 600324.317996225 6187730.71530786)), ((600429.600936197 6187591.35367451, 600444.641356193 6187602.10148683, 600456.070096387 6187604.9908987, 600495.600673942 6187602.77135048, 600500.968718579 6187613.82909971, 600513.617843729 6187654.95072952, 600518.062353805 6187667.27822029, 600550.633438774 6187662.52918694, 600554.731623389 6187674.54674081, 600560.10791387 6187694.80261778, 600562.012703903 6187706.82017164, 600575.939934919 6187708.84975853, 600572.451942782 6187708.06991726, 600679.029480308 6187706.25028764, 600720.448356207 6187705.5504301, 600723.342647555 6187702.36107928, 600690.821037651 6187590.02394518, 600640.100849386 6187414.76961769, 600627.550674368 6187371.45843355, 600607.810123123 6187303.26231468, 600600.603255208 6187304.55205215, 600545.88383246 6187309.29108754, 600539.229436113 6187309.29108754, 600524.881667038 6187370.36865538, 600513.230289047 6187419.81858998, 600506.180092174 6187449.79248888, 600492.030223362 6187485.59520135, 600470.582782348 6187523.40750476, 600464.860166407 6187533.46545749, 600427.580704344 6187583.93518453, 600429.600936197 6187591.35367451)))";

        const string Geom6a =
            @"POLYGON ((600447.93677926 6187850.1001761, 600422.73672886 6187836.8001495, 600469.63682266 6187765.4000067, 600469.63682266 6187764.7000053, 600447.93677926 6187850.1001761))";

        const string Geom6b =
            @"POLYGON ((600340.493491189 6187819.45791622, 600374.26845628 6187772.85745585, 600453.62932648 6187826.94572043, 600475.67871412 6187843.14242364, 600535.98057346 6187885.44381332, 600570.62961119 6187912.43831866, 600619.23061747 6187945.74153989, 600639.99365341 6187959.43875186, 600627.36926579 6187968.26695491, 600587.540057264 6187993.1840066, 600587.283262335 6187993.00342535, 600587.540057264 6187992.83122901, 600548.29729155 6187965.58802593, 600340.493491189 6187819.45791622))";

        const string Geom7a =
            @"POLYGON ((600447.93677926 6187850.1001761, 600422.73672886 6187836.8001495, 600469.63682266 6187765.4000067, 600469.63682266 6187764.7000053, 600447.93677926 6187850.1001761))";

        const string Geom7b =
            @"POLYGON ((600324.317996225 6187730.71530786, 600337.84118087 6187710.59940239, 600399.660275558 6187625.4967248, 600403.511084844 6187622.99723356, 600409.514059492 6187626.8064582, 600419.821364862 6187636.62445978, 600429.551461131 6187649.94174908, 600441.062659768 6187662.29923375, 600450.553626553 6187674.65671842, 600453.423180368 6187678.39595731, 600460.902161145 6187684.4447261, 600493.102183121 6187699.11174067, 600517.237769375 6187710.88934337, 600529.021080874 6187713.46881833, 600557.502227073 6187712.31905236, 600578.471409118 6187711.45922738, 600623.040197538 6187710.01952042, 600644.611326216 6187709.73957741, 600726.649231118 6187708.48983179, 600747.577183941 6187781.75491889, 600747.519463031 6187781.83490261, 600624.730595619 6187947.66114916, 600624.507957823 6187947.96108811, 600611.06723162 6187938.05310485, 600586.05758587 6187918.69704472, 600589.702249049 6187906.86945219, 600597.428605154 6187886.40361795, 600596.068040845 6187868.64723221, 600589.240481768 6187864.09815816, 600573.771277869 6187869.1071386, 600555.119178071 6187872.74639784, 600539.212944424 6187873.73619637, 600524.461128979 6187874.04613328, 600489.210144613 6187848.00143461, 600476.107498027 6187838.31340657, 600475.456076327 6187837.7935124, 600475.282913597 6187837.63354496, 600475.216946842 6187837.58355513, 600474.837638005 6187837.28361618, 600471.902117435 6187835.21403744, 600470.492078061 6187834.21424095, 600462.130791945 6187828.2954457, 600453.010888153 6187821.85675628, 600434.490721864 6187808.7894161, 600409.514059492 6187790.50313822, 600391.818477632 6187778.67554569, 600377.421233491 6187768.49761738, 600377.140874785 6187768.86754208, 600374.460975389 6187767.07790635, 600324.317996225 6187730.71530786))";

        const string Geom8a =
            @"POLYGON ((600447.93677926 6187850.1001761, 600422.73672886 6187836.8001495, 600469.63682266 6187765.4000067, 600469.63682266 6187764.7000053, 600447.93677926 6187850.1001761))";

        const string Geom8b =
            @"MULTIPOLYGON (((600548.29729155 6187965.58802593, 600501.044258405 6187932.78391656, 600340.288777426 6187819.64357722, 600308.306051507 6187866.45577176, 600406.246214967 6187935.82651594, 600418.238885504 6187938.85471894, 600424.65933969 6187950.64394421, 600431.78534905 6187970.19427639, 600435.583108981 6188027.75696937, 600465.455641203 6188049.81024852, 600487.567066505 6188059.86908971, 600587.283262335 6187993.00342535, 600587.540057264 6187993.1840066, 600627.36926579 6187968.26695491, 600639.99365341 6187959.43875186, 600619.23061747 6187945.74153989, 600570.62961119 6187912.43831866, 600535.98057346 6187885.44381332, 600475.67871412 6187843.14242364, 600453.62932648 6187826.94572043, 600374.26845628 6187772.85745585, 600340.493491189 6187819.45791622, 600548.29729155 6187965.58802593)), ((600324.317996225 6187730.71530786, 600374.460975389 6187767.07790635, 600377.140874785 6187768.86754208, 600377.421233491 6187768.49761738, 600391.818477632 6187778.67554569, 600409.514059492 6187790.50313822, 600434.490721864 6187808.7894161, 600453.010888153 6187821.85675628, 600462.130791945 6187828.2954457, 600470.492078061 6187834.21424095, 600471.902117435 6187835.21403744, 600474.837638005 6187837.28361618, 600475.216946842 6187837.58355513, 600475.282913597 6187837.63354496, 600475.456076327 6187837.7935124, 600476.107498027 6187838.31340657, 600489.210144613 6187848.00143461, 600524.461128979 6187874.04613328, 600539.212944424 6187873.73619637, 600555.119178071 6187872.74639784, 600573.771277869 6187869.1071386, 600589.240481768 6187864.09815816, 600596.068040845 6187868.64723221, 600597.428605154 6187886.40361795, 600589.702249049 6187906.86945219, 600586.05758587 6187918.69704472, 600611.06723162 6187938.05310485, 600624.507957823 6187947.96108811, 600624.730595619 6187947.66114916, 600747.519463031 6187781.83490261, 600747.577183941 6187781.75491889, 600726.649231118 6187708.48983179, 600644.611326216 6187709.73957741, 600623.040197538 6187710.01952042, 600578.471409118 6187711.45922738, 600557.502227073 6187712.31905236, 600529.021080874 6187713.46881833, 600517.237769375 6187710.88934337, 600493.102183121 6187699.11174067, 600460.902161145 6187684.4447261, 600453.423180368 6187678.39595731, 600450.553626553 6187674.65671842, 600441.062659768 6187662.29923375, 600429.551461131 6187649.94174908, 600419.821364862 6187636.62445978, 600409.514059492 6187626.8064582, 600403.511084844 6187622.99723356, 600399.660275558 6187625.4967248, 600337.84118087 6187710.59940239, 600324.317996225 6187730.71530786)), ((600429.600936197 6187591.35367451, 600444.641356193 6187602.10148683, 600456.070096387 6187604.9908987, 600495.600673942 6187602.77135048, 600500.968718579 6187613.82909971, 600513.617843729 6187654.95072952, 600518.062353805 6187667.27822029, 600550.633438774 6187662.52918694, 600554.731623389 6187674.54674081, 600560.10791387 6187694.80261778, 600562.012703903 6187706.82017164, 600575.939934919 6187708.84975853, 600572.451942782 6187708.06991726, 600679.029480308 6187706.25028764, 600720.448356207 6187705.5504301, 600723.342647555 6187702.36107928, 600690.821037651 6187590.02394518, 600640.100849386 6187414.76961769, 600627.550674368 6187371.45843355, 600607.810123123 6187303.26231468, 600600.603255208 6187304.55205215, 600545.88383246 6187309.29108754, 600539.229436113 6187309.29108754, 600524.881667038 6187370.36865538, 600513.230289047 6187419.81858998, 600506.180092174 6187449.79248888, 600492.030223362 6187485.59520135, 600470.582782348 6187523.40750476, 600464.860166407 6187533.46545749, 600427.580704344 6187583.93518453, 600429.600936197 6187591.35367451)))";

        const string Geom9a =
            @"POLYGON ((685906.093680791 6178529.64258719, 685908.081376412 6178526.42932171, 685938.74126611 6178532.85536543, 685954.168529343 6178516.56153321, 685962.000395118 6178517.21617818, 685951.82720747 6178529.42341483, 685971.181878291 6178517.98363409, 685983.220126376 6178518.98987943, 685975.570892074 6178515.38946156, 685998.6237405 6178501.76383424, 685998.22187495 6178501.20348975, 686022.99845624 6178495.99500847, 686023.40250261 6178494.59529338, 686030.996925202 6178492.79565969, 686044.60256829 6178490.3961481, 686051.66925685 6178488.95644115, 686044.65204336 6178490.42614199, 686031.07938365 6178492.8756434, 686023.41074845 6178494.6752771, 686022.90775195 6178496.48490875, 686051.99084478 6178490.75607484, 686051.835364402 6178489.88599328, 686063.29589731 6178487.39675862, 686062.99904692 6178486.19700282, 686151.2834478 6178468.60135265, 686151.30379348 6178468.68056824, 686065.77789644 6178485.76709033, 686066.94056049 6178487.40675658, 686151.37800608 6178469.97030572, 686164.71978215 6178514.26129042, 686138.53922651 6178520.35005107, 686130.49128248 6178488.88645539, 686100.83922639 6178490.37615217, 686086.68935758 6178495.47511429, 686066.60248087 6178506.60284927, 686062.47131288 6178510.06214514, 685995.166800687 6178525.42445044, 685993.16355923 6178525.68399249, 685991.71875589 6178516.17429284, 685948.02806036 6178536.87895512, 685994.499540016 6178554.4385395, 685994.163797748 6178554.5060103, 685945.01423795 6178543.95963837, 685953.27004214 6178562.72402392, 685936.83141522 6178549.73842662, 685913.113903073 6178565.91412674, 685910.563651239 6178563.86442113, 685930.87270861 6178542.42240222, 685906.093680791 6178529.64258719))";

        const string Geom9b =
            @"POLYGON ((685642.32905431 6178416.41120752, 685648.96695897 6178414.34162878, 685765.142659253 6178388.51688533, 685797.63128578 6178380.95842383, 685987.97835551 6178339.82679605, 685990.20473347 6178339.33689577, 685990.212979314 6178339.31689984, 686062.47131288 6178324.08000127, 686103.51912579 6178315.33178194, 686111.501103064 6178313.91207092, 686138.308342871 6178418.08086767, 686151.2834478 6178468.60135265, 686151.30379348 6178468.68056824, 686065.77789644 6178485.76709033, 686066.94056049 6178487.40675658, 686151.37800608 6178469.97030572, 686164.71978215 6178514.26129042, 686138.53922651 6178520.35005107, 686130.49128248 6178488.88645539, 686100.83922639 6178490.37615217, 686086.68935758 6178495.47511429, 686066.60248087 6178506.60284927, 686062.47131288 6178510.06214514, 685995.67172824 6178525.3590315, 685993.16355923 6178525.68399249, 685991.71875589 6178516.17429284, 685948.02806036 6178536.87895512, 685995.35398235 6178554.76139671, 685945.01423795 6178543.95963837, 685953.27004214 6178562.72402392, 685936.83141522 6178549.73842662, 685900.42638552 6178574.56720459, 685930.87270861 6178542.42240222, 685894.708623573 6178523.77072948, 685894.23756482 6178523.52778033, 685895.041016367 6178523.69617672, 685938.74126611 6178532.85536543, 685961.275482995 6178509.05537294, 685961.533932852 6178508.78240563, 685961.360770122 6178508.7324158, 685961.500949475 6178508.70242191, 685958.499462151 6178507.90258471, 685892.697624669 6178521.19987809, 685858.197012134 6178527.8985146, 685756.896814957 6178549.40413719, 685688.596486653 6178564.80100321, 685676.722470866 6178566.89057788, 685666.942899531 6178524.29924722, 685658.60635095 6178473.80952426, 685654.203070094 6178473.79952629, 685653.221814623 6178469.1204787, 685642.32905431 6178416.41120752), (685970.407681782 6178507.12792054, 685951.82720747 6178529.42341483, 685998.6237405 6178501.76383424, 685998.22187495 6178501.20348975, 685997.79915607 6178500.61406827, 685997.716697623 6178500.62406624, 685997.700205935 6178500.6040703, 685982.395918921 6178503.20354119, 685977.003136751 6178504.00337839, 685976.564585182 6178504.21554291, 685971.31781437 6178506.03581409, 685970.407681782 6178507.12792054), (686023.41074845 6178494.6752771, 686022.90775195 6178496.48490875, 686051.99084478 6178490.75607484, 686051.835364402 6178489.88599328, 686051.669256796 6178488.95644116, 686051.619781786 6178488.96643911, 686044.65204336 6178490.42614199, 686031.07938365 6178492.8756434, 686023.41074845 6178494.6752771), (686051.619781786 6178488.96643911, 686051.603290098 6178488.89645336, 686044.60256829 6178490.3961481, 686051.619781786 6178488.96643911))";

        [TestCase(1, Geom1a, Geom1b)]
        [TestCase(2, Geom2a, Geom2b)]
        [TestCase(3, Geom3a, Geom3b)]
        [TestCase(4, Geom4a, Geom4b)]
        [TestCase(5, Geom5a, Geom5b)]
        [TestCase(6, Geom6a, Geom6b)]
        [TestCase(7, Geom7a, Geom7b)]
        [TestCase(8, Geom8a, Geom8b)]
        [TestCase(9, Geom9a, Geom9b)]
        public void Test(int number, string wkt1, string wkt2)
        {
            const double scaleFactor = 1e10;

            var reader = new WKTReader();
            var geom1 = reader.Read(wkt1);
            var ve1 = new IsValidOp(geom1).ValidationError;
            if (ve1 != null)
            {
                Debug.WriteLine(string.Format("geom1 is not valid:\n{0} at {1}", ve1.Message, ve1.Coordinate));
                Debug.WriteLine("Attempt to make geom1 a valid geometry");
                Debug.WriteLine(geom1.AsText());
                geom1 = geom1.Buffer(0);
                Debug.WriteLine(geom1.AsText());
            }
            var geom2 = reader.Read(wkt2);
            var ve2 = new IsValidOp(geom1).ValidationError;
            if (ve2 != null)
            {
                Debug.WriteLine(string.Format("geom2 is not valid:\n{0} at {1}", ve2.Message, ve2.Coordinate));
                Debug.WriteLine("Attempt to make geom2 a valid geometry");
                Debug.WriteLine(geom2.AsText());
                geom2 = geom2.Buffer(0);
                Debug.WriteLine(geom2.AsText());
            }

            IGeometry result = null;
            try
            {
                result = geom1.Intersection(geom2);
            }
            catch (TopologyException)
            {
                Debug.WriteLine("Probing with SnapRoundOverlayFunctions");
                Assert.DoesNotThrow(() => result = SnapRoundOverlayFunctions.Intersection(geom1, geom2, scaleFactor));
            }

            ToImage(number, geom1, geom2, result);
        }

        static void ToImage(int nr, IGeometry geom1, IGeometry geom2, IGeometry geom3)
        {

            //var gpw = new Windows.Forms.GraphicsPathWriter();

            //var extent = geom1.EnvelopeInternal;
            //if (geom2 != null)
            //    extent.ExpandToInclude(geom2.EnvelopeInternal);
            //extent.ExpandBy(0.05 * extent.Width);

            //using (var img = new Bitmap(ImageWidth, ImageHeight))
            //{
            //    using (var gr = Graphics.FromImage(img))
            //    {
            //        var at = CreateAffineTransformation(extent);
            //        gr.Clear(Color.WhiteSmoke);
            //        gr.SmoothingMode = SmoothingMode.AntiAlias;
            //        //gr.Transform = CreateTransform(extent);

            //        var gp1 = gpw.ToShape(at.Transform(geom1));
            //        if (geom1 is IPolygonal)
            //            gr.FillPath(new SolidBrush(Color.FromArgb(64, Color.Blue)), gp1);
            //        gr.DrawPath(Pens.Blue, gp1);

            //        var gp2 = gpw.ToShape(at.Transform(geom2));
            //        if (geom2 is IPolygonal)
            //            gr.FillPath(new SolidBrush(Color.FromArgb(64, Color.OrangeRed)), gp2);
            //        gr.DrawPath(Pens.OrangeRed, gp2);

            //        //at = CreateAffineTransformation(extent, ImageWidth);

            //        var gp3 = gpw.ToShape(at.Transform(geom3));
            //        if (geom3 is IPolygonal)
            //            gr.FillPath(new SolidBrush(Color.FromArgb(64, Color.Gold)), gp3);
            //        gr.DrawPath(Pens.Gold, gp3);

            //    }
            //    var path = System.IO.Path.ChangeExtension(System.IO.Path.GetTempFileName(), "png");
            //    img.Save(path, ImageFormat.Png);
            //    Console.WriteLine("Image for Test {0} written to {1}", nr, new Uri(path).AbsoluteUri);
            //}
        }

        private const int ImageWidth = 640;
        private const int ImageHeight = 480;

        private static AffineTransformation CreateAffineTransformation(Envelope env, int offsetX = 0)
        {
            var imageRatio = ImageWidth / ImageHeight;
            var ratio = env.Width / env.Height;
            if (ratio > imageRatio)
            {
                var growHeight = (env.Width / imageRatio - env.Height) / 2;
                env.ExpandBy(0, growHeight);
            }
            else if (ratio < imageRatio)
            {
                var growWidth = (env.Height * imageRatio - env.Width) / 2;
                env.ExpandBy(growWidth, 0);
            }

            var s1 = new Coordinate(env.MinX, env.MaxY);
            var t1 = new Coordinate(offsetX, 0);
            var s2 = new Coordinate(env.MaxX, env.MaxY);
            var t2 = new Coordinate(offsetX + ImageWidth, 0);
            var s3 = new Coordinate(env.MaxX, env.MinY);
            var t3 = new Coordinate(offsetX + ImageWidth, ImageHeight);

            var atb = new AffineTransformationBuilder(s1, s2, s3, t1, t2, t3);
            return atb.GetTransformation();
        }
    }
}
